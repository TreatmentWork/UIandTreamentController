<!DOCTYPE html>
<meta charset="utf-8">
<html>
<style>


</style>
<head>

  <link rel="stylesheet" href="css/rads-style-admin.css">
  <script type="text/JavaScript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
  <!-- <script type="text/javascript" src="test.json"></script> -->
  <script type="text/javascript" src="//code.jquery.com/jquery-1.10.1.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src=”jquery-latest.pack.js” type=”text/javascript”></script>
</head>
<body onload="CreateTableFromJSONongoing">
  <header>
   <h1>RADS prototype</h1>
  </header>
  <div class="menu-bar">
    <ul>
      <li><a  href="singleTreatment" >Run Treatment</a></li>
      <li><a href="treatmentCatalogue" >View Catalogue</a></li>
      <li><a href="admin" class="active">Submitted treatments</a></li>
  </ul>
</div>


<div class="container">

<!-- <nav>

<br/>

<p class="filesRunning"><b>3</b></p>
  <p>files are running</p>

 <input type="button" id="btnGetCount" value="Count Rows" onclick = "CountRows()" />

</nav> -->

<article>
  <input type="button" onclick="CreateTableFromJSONongoing()" value="Ongoing Jobs" />
  <input type="button" onclick="CreateTableFromJSONhistorical()" value="Historical Jobs" />
  <input type="button" onclick="CreateTableFromJSONfulllogs()" value="Full Logs" />

  <h1>Ongoing Jobs</h1>
  <br/>
  <div id="showData" ></div>
  <br/>

  <!-- <button onclick="move()" class="test-btn">test progress bar</button>
  <button onclick="showTreatmentDescription()" class="test-btn">test log link</button> -->

 <br/>
 <br/>
<h1>Historical Records</h1>
<div id="showHistoricalData"></div>
<br/>
<br/>
<h1>Full logs</h1>
<div id="showFullLogData"></div>
<br/>
<br/>
</article>

<script>
// document.addEventListener('DOMContentLoaded', function() {
//
//  window.onload = CreateTableFromJSONongoing;
//  // window.onload = CreateTableFromJSONhistorical;
//  // window.onload = CreateTableFromJSONfulllogs;
//  // alert("Ready!");
// }, false);

// function move() {
//   var elem = document.getElementById("progressBar");
//   var width = 0;
//   var id = setInterval(frame, 10);
//   function frame() {
//     if (width >= 100) {
//       clearInterval(id);
//     } else {
//       width++;
//       elem.style.width = width + '%';
//       document.getElementById("label").innerHTML = width * 1  + '%';
//     }
//   }
// }

//load in treatment versions and description
var logInfo;
function readTextFile(file, callback) {
  var rawFile = new XMLHttpRequest();
  rawFile.overrideMimeType("application/json");
  rawFile.open("GET", file, true);
  rawFile.onreadystatechange = function() {
    if (rawFile.readyState === 4 && rawFile.status == "200") {

      callback(rawFile.responseText);
      allText = rawFile.responseText;
      lines = rawFile.responseText.split("\n");
      // console.log(lines);

    }
  }
  rawFile.send(null);
}
var myList;
var addBrackets;
var unstring;
// var path = require("path");
// console.log(". = %s", path.resolve("."));
// console.log("__dirname = %s", path.resolve(__dirname));
readTextFile('TController1.log', function(logtext){
  logInfo = JSON.stringify(logtext);
var  s = logtext.replace(/\n/g, ",");

var newStr = s.substring(0, s.length-1);

var addBrackets = '['+newStr+']'; //{"Logs":}
// console.log(addBrackets);

 myList = JSON.parse(addBrackets);
  console.log(myList);


 var myReversedArray = new Array();
 $(myList).each(function (key) {
     myReversedArray.unshift(myList[key]);
 });
 myList = myReversedArray;
 $(myList).each(function (key) {
     console.log(myList[key]);
 });

});

function CreateTableFromJSONongoing() {

var myBooks = myList;
        // EXTRACT VALUE FOR HTML HEADER.
        var col = [];
        for (var i = 0; i < myBooks.length; i++) {
            for (var key in myBooks[i]) {
                if (col.indexOf(key) === -1) {
                    col.push(key);
                }
            }
        }
        // CREATE DYNAMIC TABLE.
        var table = document.createElement("table");
        // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.
        var tr = table.insertRow(-1);                   // TABLE ROW.
        for (var i = 0; i < col.length; i++) {
            var th = document.createElement("th");      // TABLE HEADER.
            th.innerHTML = col[i];
            tr.class = "sortnr";
            tr.appendChild(th);

        }
        // ADD JSON DATA TO THE TABLE AS ROWS.
        for (var i = 0; i < myBooks.length; i++) {
            tr = table.insertRow(-1);
            for (var j = 0; j < col.length; j++) {
                var tabCell = tr.insertCell(-1);
                   tabCell.innerHTML = myBooks[i][col[j]];
            }
        }

        table.id = "showDataTable";

        // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
        var divContainer = document.getElementById("showData");
        divContainer.innerHTML = "";
        divContainer.appendChild(table);


    var seen = {};
    $('#showData tr').each(function() {
      var txt = $(this).find("td:first").text();

      if (seen[txt])
        $(this).remove();
      else
        seen[txt] = true;
    });
        $('#showData tr td:contains("completed")').parents("tr").remove();


}

    function CreateTableFromJSONhistorical() {

    var myBooks = myList;
            var col = [];
            for (var i = 0; i < myBooks.length; i++) {
                for (var key in myBooks[i]) {
                    if (col.indexOf(key) === -1) {
                        col.push(key);
                    }
                }
            }
            // CREATE DYNAMIC TABLE.
            var table = document.createElement("table");
            // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.
            var tr = table.insertRow(-1);                   // TABLE ROW.
            for (var i = 0; i < col.length; i++) {
                var th = document.createElement("th");      // TABLE HEADER.
                th.innerHTML = col[i];
                tr.appendChild(th);
            }
            // ADD JSON DATA TO THE TABLE AS ROWS.
            for (var i = 0; i < myBooks.length; i++) {
                tr = table.insertRow(-1);
                for (var j = 0; j < col.length; j++) {
                    var tabCell = tr.insertCell(-1);
                    tabCell.innerHTML = myBooks[i][col[j]];
                }
            }
            // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
            var divContainer = document.getElementById("showHistoricalData");
            divContainer.innerHTML = "";
            divContainer.appendChild(table);


                var seen = {};
                $('#showHistoricalData tr').each(function() {
                  var txt = $(this).find("td:first").text();

                  if (seen[txt])
                    $(this).remove();
                  else
                    seen[txt] = true;
                });
                    $('#showHistoricalData tr td:contains("incomplete")').parents("tr").remove();

        }

  function CreateTableFromJSONfulllogs() {

        var myBooks = myList;
                var col = [];
                for (var i = 0; i < myBooks.length; i++) {
                    for (var key in myBooks[i]) {
                        if (col.indexOf(key) === -1) {
                            col.push(key);
                        }
                    }
                }
                // CREATE DYNAMIC TABLE.
                var table = document.createElement("table");
                // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.
                var tr = table.insertRow(-1);                   // TABLE ROW.
                for (var i = 0; i < col.length; i++) {
                    var th = document.createElement("th");      // TABLE HEADER.
                    th.innerHTML = col[i];
                    tr.appendChild(th);
                }
                // ADD JSON DATA TO THE TABLE AS ROWS.
                for (var i = 0; i < myBooks.length; i++) {
                    tr = table.insertRow(-1);
                    for (var j = 0; j < col.length; j++) {
                        var tabCell = tr.insertCell(-1);
                        tabCell.innerHTML = myBooks[i][col[j]];
                    }
                }
                // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
                var divContainer = document.getElementById("showFullLogData");
                divContainer.innerHTML = "";
                divContainer.appendChild(table);

            }
</script>

</body>
</html>
