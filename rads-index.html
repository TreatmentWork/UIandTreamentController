<!DOCTYPE html>
<meta charset="utf-8">
<html>
<style>

path {
  stroke: #fff;
  fill-rule: evenodd;
}

text {
  font-family: Arial, sans-serif;
  font-size: 12px;
}

</style>
<head>
      <script type="text/JavaScript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
      <script type="text/javascript" src="test.json"></script>
      <script type="text/javascript" src="//code.jquery.com/jquery-1.10.1.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
  <script src=”jquery-latest.pack.js” type=”text/javascript”></script>
  <script src="http://d3js.org/d3.v3.min.js"></script>

  <link rel="stylesheet" href="stylesheets/rads-style.css">
</head>
<body>
  <header>
   <h1>RADS prototype</h1>
  </header>



<div class="container">

<nav>
  <h1>Choose the files you want to run</h1>

<br/>
<p>Upload files from computer:</p>

  <form action="myform.cgi">
  <input type="file" name="fileupload" value="fileupload" id="fileupload">
  <label for="fileupload"> Select a file to upload</label>
  <input type="submit" value="submit">
  </form>


<br/>
<br/>
<p>Choose files from dropdown:</p>
  <select id="filedropDown" onchange="selectIngredient(this);">
   <option>Please select files</option>

  </select>
  <ul class="options">

  </ul>
<br/>


</div><br/>

</nav>

<article>
<h1>Choose the treatment you want to run</h1>

<p id="selectedTreatment"></p><input type="button" id="btnShow" value='View Description' onclick="viewDescription()">

<br/>
<p id="treatmentDescription"></p>
<br/>

<input type="button" id="btnAdd" value='Add Treatment' onclick="addTreatment()">
<form action="/treatment/do/clamAV/singlescan" method="post">

<ul class="options" id="chosenTreatments" >

</ul>

<input type="submit" />

</form>


   <script src="http://d3js.org/d3.v3.min.js"></script>
   <script>
//d3 code
   var width = 960,
       height = 700,
       radius = Math.min(width, height) / 2;

   var x = d3.scale.linear()
       .range([0, 2 * Math.PI]);

   var y = d3.scale.linear()
       .range([0, radius]);

   var color = d3.scale.category20c();

   var svg = d3.select("body").append("svg")
       .attr("width", width)
       .attr("height", height)
     .append("g")
       .attr("transform", "translate(" + width / 2 + "," + (height / 2 + 10) + ")");

   var partition = d3.layout.partition()
       .value(function(d) { return d.size; });

   var arc = d3.svg.arc()
       .startAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x))); })
       .endAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x + d.dx))); })
       .innerRadius(function(d) { return Math.max(0, y(d.y)); })
       .outerRadius(function(d) { return Math.max(0, y(d.y + d.dy)); });

   d3.json("flare.json", function(error, root) {
     var g = svg.selectAll("g")
         .data(partition.nodes(root))
       .enter().append("g");

     var path = g.append("path")
       .attr("d", arc)
       .style("fill", function(d) { return color((d.children ? d : d.parent).name); })
       .on("click", click);

     var text = g.append("text")
       .attr("transform", function(d) { return "rotate(" + computeTextRotation(d) + ")"; })
       .attr("x", function(d) { return y(d.y); })
       .attr("dx", "6") // margin
       .attr("dy", ".35em") // vertical-align
       .text(function(d) { return d.name; });


     function click(d) {
       // fade out all text elements
       text.transition().attr("opacity", 0);

       path.transition()
         .duration(750)
         .attrTween("d", arcTween(d))
         .each("end", function(e, i) {
             // check if the animated element's data e lies within the visible angle span given in d
             if (e.x >= d.x && e.x < (d.x + d.dx)) {
               // get a selection of the associated text element
               var arcText = d3.select(this.parentNode).select("text");
               // fade in the text element and recalculate positions
               arcText.transition().duration(750)
                 .attr("opacity", 1)
                 .attr("transform", function() { return "rotate(" + computeTextRotation(e) + ")" })
                 .attr("x", function(d) { return y(d.y);
                 });

              var chosenTreat = d3.select(this.parentNode).text();
              console.log(chosenTreat);
              document.getElementById("selectedTreatment").innerHTML = chosenTreat;


            }


         });
     }
   });

   d3.select(self.frameElement).style("height", height + "px");

   // Interpolate the scales!
   function arcTween(d) {
     var xd = d3.interpolate(x.domain(), [d.x, d.x + d.dx]),
         yd = d3.interpolate(y.domain(), [d.y, 1]),
         yr = d3.interpolate(y.range(), [d.y ? 20 : 0, radius]);
     return function(d, i) {
       return i
           ? function(t) { return arc(d); }
           : function(t) { x.domain(xd(t)); y.domain(yd(t)).range(yr(t)); return arc(d); };
     };
   }

   function computeTextRotation(d) {
     return (x(d.x + d.dx / 2) - Math.PI / 2) / Math.PI * 180;
   }

   </script>

<!--
 <form id="treatment-selection" action="/contact/" method="post" >
</form> -->




</article>


</div>
<script>




//add treatments to bullet list

    var list = document.getElementById('chosenTreatments');

    function addTreatment() {
        var x = document.getElementById('selectedTreatment').innerHTML;
        var entry = document.createElement('li');
        entry.appendChild(document.createTextNode(x));

        list.appendChild(entry);
        entry.setAttribute("name", "TreatmentType");

        entry.onclick = function() {this.parentNode.removeChild(this);}

    }


    function readTextFile(file, callback) {
      var rawFile = new XMLHttpRequest();
      rawFile.overrideMimeType("application/json");
      rawFile.open("GET", file, true);
      rawFile.onreadystatechange = function() {
          if (rawFile.readyState === 4 && rawFile.status == "200") {
              callback(rawFile.responseText);
          }
      }
      rawFile.send(null);
  }
var data ;
  //usage:
  readTextFile("test.json", function(text){
       data = JSON.parse(text);

             $.each(data.Files, function (key, value) {
                 $("#filedropDown").append($('<option></option>').val(value.name).html(value.path));
             });

});




function readTextFile(file, callback) {
  var rawFile = new XMLHttpRequest();
  rawFile.overrideMimeType("application/json");
  rawFile.open("GET", file, true);
  rawFile.onreadystatechange = function() {
      if (rawFile.readyState === 4 && rawFile.status == "200") {
          callback(rawFile.responseText);
      }
  }
  rawFile.send(null);
}
var flaredata ;
//usage:
readTextFile("flaretesting.json", function(flaretext){
   flaredata = JSON.parse(flaretext);
console.log(flaredata);


});


 function viewDescription() {
   document.getElementById("treatmentDescription").innerHTML = flaredata;
console.log(flaredata.children.name);
 };


//choose from file list
function selectIngredient(select)
{
  var option = select.options[select.selectedIndex];
  var ul = select.parentNode.getElementsByTagName('ul')[0];

  var choices = ul.getElementsByTagName('input');
  for (var i = 0; i < choices.length; i++)
    if (choices[i].value == option.value)
      return;

  var li = document.createElement('li');
  var input = document.createElement('input');
  var text = document.createTextNode(option.firstChild.data);

  input.type = 'hidden';
  input.name = 'ingredients[]';
  input.value = option.value;

  li.appendChild(input);
  li.appendChild(text);
  li.setAttribute('onclick', 'this.parentNode.removeChild(this);');

  ul.appendChild(li);
}
</script>

</body>
<footer></footer>
</html>
